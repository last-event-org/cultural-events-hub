<!DOCTYPE html>
<html lang="{{ i18n.locale }}">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Next Events - {{ i18n.t('messages.cart_title') }}</title>
  @vite(['resources/css/app.css', 'resources/js/app.js'])
</head>

<body class="bg-slate-50 text-xs sm:text-sm md:text-base">
  @include("pages/partials/header")
  <main class="flex flex-col items-center min-h-screen">
    <div class="w-screen sm:w-[600px] lg:w-[800px] bg-white text-slate-600 flex flex-col border rounded-3xl shadow p-4 md:p-8 mt-10 gap-6">
      <div class=" flex justify-center font-bold text-xl items-center self-center shadow hover:shadow-inner duration-1000 border bg-slate-100 rounded-full p-3 gap-4">
        <div class="flex justify-center items-center bg-yellow-500 rounded-full p-2">
          <svg xmlns="http://www.w3.org/2000/svg" height="20px" width="20px" fill="currentColor" viewBox="0 0 512 512">
            <path d="M 56.888888888888886 85.33333333333333 Q 32.888888888888886 86.22222222222223 16.88888888888889 102.22222222222223 L 16.88888888888889 102.22222222222223 L 16.88888888888889 102.22222222222223 Q 0.8888888888888888 118.22222222222223 0 142.22222222222223 L 0 195.55555555555554 L 0 195.55555555555554 Q 0.8888888888888888 210.66666666666666 14.222222222222221 216 Q 40.888888888888886 226.66666666666666 42.666666666666664 256 Q 40.888888888888886 285.3333333333333 14.222222222222221 296 Q 0.8888888888888888 302.22222222222223 0 316.44444444444446 L 0 369.77777777777777 L 0 369.77777777777777 Q 0.8888888888888888 393.77777777777777 16.88888888888889 409.77777777777777 Q 32.888888888888886 425.77777777777777 56.888888888888886 426.6666666666667 L 455.1111111111111 426.6666666666667 L 455.1111111111111 426.6666666666667 Q 479.1111111111111 425.77777777777777 495.1111111111111 409.77777777777777 Q 511.1111111111111 393.77777777777777 512 369.77777777777777 L 512 316.44444444444446 L 512 316.44444444444446 Q 511.1111111111111 302.22222222222223 497.77777777777777 296 Q 471.1111111111111 285.3333333333333 469.3333333333333 256 Q 471.1111111111111 226.66666666666666 497.77777777777777 216 Q 511.1111111111111 209.77777777777777 512 195.55555555555554 L 512 142.22222222222223 L 512 142.22222222222223 Q 511.1111111111111 118.22222222222223 495.1111111111111 102.22222222222223 Q 479.1111111111111 86.22222222222223 455.1111111111111 85.33333333333333 L 56.888888888888886 85.33333333333333 L 56.888888888888886 85.33333333333333 Z M 42.666666666666664 142.22222222222223 Q 43.55555555555556 128.88888888888889 56.888888888888886 128 L 455.1111111111111 128 L 455.1111111111111 128 Q 468.44444444444446 128.88888888888889 469.3333333333333 142.22222222222223 L 469.3333333333333 182.22222222222223 L 469.3333333333333 182.22222222222223 Q 449.77777777777777 193.77777777777777 438.22222222222223 212.44444444444446 Q 426.6666666666667 232 426.6666666666667 256 Q 426.6666666666667 280 438.22222222222223 299.55555555555554 Q 449.77777777777777 318.22222222222223 469.3333333333333 329.77777777777777 L 469.3333333333333 369.77777777777777 L 469.3333333333333 369.77777777777777 Q 468.44444444444446 383.1111111111111 455.1111111111111 384 L 56.888888888888886 384 L 56.888888888888886 384 Q 43.55555555555556 383.1111111111111 42.666666666666664 369.77777777777777 L 42.666666666666664 329.77777777777777 L 42.666666666666664 329.77777777777777 Q 62.22222222222222 318.22222222222223 73.77777777777777 299.55555555555554 Q 85.33333333333333 280 85.33333333333333 256 Q 85.33333333333333 232 73.77777777777777 212.44444444444446 Q 62.22222222222222 193.77777777777777 42.666666666666664 182.22222222222223 L 42.666666666666664 142.22222222222223 L 42.666666666666664 142.22222222222223 Z M 355.55555555555554 298.6666666666667 L 156.44444444444446 298.6666666666667 L 355.55555555555554 298.6666666666667 L 156.44444444444446 298.6666666666667 L 156.44444444444446 213.33333333333334 L 156.44444444444446 213.33333333333334 L 355.55555555555554 213.33333333333334 L 355.55555555555554 213.33333333333334 L 355.55555555555554 298.6666666666667 L 355.55555555555554 298.6666666666667 Z M 113.77777777777777 199.11111111111111 L 113.77777777777777 312.8888888888889 L 113.77777777777777 199.11111111111111 L 113.77777777777777 312.8888888888889 Q 113.77777777777777 325.3333333333333 121.77777777777777 333.3333333333333 Q 129.77777777777777 341.3333333333333 142.22222222222223 341.3333333333333 L 369.77777777777777 341.3333333333333 L 369.77777777777777 341.3333333333333 Q 382.22222222222223 341.3333333333333 390.22222222222223 333.3333333333333 Q 398.22222222222223 325.3333333333333 398.22222222222223 312.8888888888889 L 398.22222222222223 199.11111111111111 L 398.22222222222223 199.11111111111111 Q 398.22222222222223 186.66666666666666 390.22222222222223 178.66666666666666 Q 382.22222222222223 170.66666666666666 369.77777777777777 170.66666666666666 L 142.22222222222223 170.66666666666666 L 142.22222222222223 170.66666666666666 Q 129.77777777777777 170.66666666666666 121.77777777777777 178.66666666666666 Q 113.77777777777777 186.66666666666666 113.77777777777777 199.11111111111111 L 113.77777777777777 199.11111111111111 Z" />
          </svg>
        </div>

        <h1>{{ i18n.t('messages.cart_myCart') }}</h1>
      </div>
      
      @if(flashMessages.has('cartValidated'))
        @!component('components/notifications/success', { message: flashMessages.get('cartValidated') })
      @elseif(flashMessages.has('error'))
        @!component('components/notifications/error', { message: flashMessages.get('error') })
      @elseif((flashMessages.has('success')))
        @!component('components/notifications/success', { message: flashMessages.get('success') })
      @end
      @if(!order) 
        <p class="text-center text-slate-600">{{ i18n.t('messages.cart_empty') }}</p>
      @else
        <div class="overflow-x-auto">
          <div class="border border-slate-300 sm:rounded-lg overflow-hidden">
            <table class="min-w-full bg-white">
              <thead class="bg-slate-700 text-white text-right">
                <tr>
                  <th scope="col" class="p-2 text-left">{{ i18n.t('messages.cart_event') }}</th>
                  <th scope="col" class="p-2 text-center">{{ i18n.t('messages.cart_qty') }}</th>
                  <th scope="col" class="p-2 min-w-12 sm:min-w-20">{{ i18n.t('messages.cart_price') }}</th>
                  <th scope="col" class="p-2 min-w-12 sm:min-w-20">{{ i18n.t('messages.cart_total') }}</th>
                  <th scope="col" class="p-2 max-w-14"></th>
                </tr>
              </thead>
              <tbody>
                @each(item in order.orderLineId)
                <tr name="orderLineQtyRow-{{item.id}}" class="border-t border-slate-200">
                  <td class="p-2">
                    <a href="{{route('events.show', [item.price.event.id])}}">{{item.price.event.title}}</a>
                    <br><span class="italic">{{item.price.description}}</span>
                  </td>
                  <td class="p-2">
                    <div class="flex items-center flex-row justify-around">
                      <form action="{{ route('cart.remove', [item.id]) }}" method="post">
                        {{ csrfField() }}
                        <button onclick="removeQuantity({{item.id}})" class="text-center lg:py-2 lg:px-4 text-xl text-red-600 font-bold " type="submit">-</button>
                      </form>
                      <span name="orderLineQty-{{item.id}}">{{item.qty}}</span>
                      <form action="{{ route('cart.add', [item.id]) }}" method="post">
                        {{ csrfField() }}
                        <button onclick="addQuantity({{item.id}})" class="text-center lg:py-2 lg:px-4 text-xl text-green-600 font-bold" type="submit">+</button>
                      </form>
                    </div>
                  </td>
                  <td class="p-2 box-content text-right"><span name="discount-price-{{item.id}}">{{item.price.discountedPrice}}</span>€</td>
                  <td class="p-2 text-right"><span name="total-price-{{item.id}}" data-subtotal="{{item.qty * item.price.discountedPrice}}">{{item.qty * item.price.discountedPrice}}</span>€</td>
                  <td class="p-2">
                    <form name="removeOrderLine-{{item.id}}" action="{{ route('cart.delete', [item.id], { qs: {_method: 'DELETE'}})}}" method="post" class="flex justify-center items-center">
                      {{ csrfField() }}
                      <input type="hidden" name="_method" value="DELETE" />
                      <button onclick="removeOrderLine({{item.id}})" class="pl-2 hover:scale-105 duration-300" type="submit">
                        <img src="/svg/cancel.svg" alt="delete">
                      </button>
                    </form>
                  </td>
                </tr>
                @end
              </tbody>
              <tfoot class="bg-slate-100">
                <tr>
                  <th scope="row" colspan="3" class="py-2 text-right">{{ i18n.t('messages.cart_total') }} :</th>
                  <td class="px-2 text-right"><span data-total-order="{{totalOrder}}">{{totalOrder}}</span>€</td>
                  <td class="px-4"></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <div class="mt-6 flex items-center gap-4 justify-end">
          <form action="{{ route('cart.destroy', [order.id], { qs: {_method: 'DELETE'}}) }}" method="post" enctype="multipart/form-data">
            {{ csrfField() }}
            <input type="hidden" name="_method" value="DELETE" />
            <button class="mt-2 text-center py-1 px-2 lg:py-2 lg:px-4 bg-red-700 hover:bg-red-500 focus:ring-2 text-sm text-white font-bold rounded-md transition duration-200" type="submit">
              {{ i18n.t('messages.cart_emptyCart') }}
            </button>
          </form>
          
          <form action="{{route('cart.validate', [order.id])}}" method="POST">
            {{ csrfField() }}
            <button class="mt-2 text-center py-1 px-2 lg:py-2 lg:px-4 bg-indigo-700 hover:bg-indigo-500 focus:ring-2 text-sm text-white font-bold rounded-md transition duration-200" type="submit">
              {{ i18n.t('messages.cart_validateCart') }}
            </button>
          </form>
        </div>
      @end

      <div id="notification"></div>
    </div>
  </main>
  
  @include("pages/partials/footer")
  <script src="/resources/js/cart.js" defer></script>
</body>
</html>
